<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="robots" content="noindex, nofollow">
  <meta name="description" content="Herramienta interna para configuración de Ring Scanner RS5100">
  <title>Configuración Ring Scanner RS5100 - Herramienta Interna</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: url('imagen meli.jpg') no-repeat center center fixed;
      background-size: cover;
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    .meli-logo {
      height: 40px;
    }

    .btn-icon {
      height: 18px;
      width: 18px;
      object-fit: contain;
      vertical-align: -3px;
      margin-right: 8px;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      padding: 30px 40px;
      width: 450px;
      max-width: 90%;
      text-align: center;
      position: relative;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .switch-wrapper {
      display: flex;
      align-items: center;
      font-size: 0.9em;
      gap: 8px;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 30px;
      border-radius: 34px;
      background-color: #f5f5f5;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 34px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 24px;
      width: 24px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    input:checked + .slider {
      background-color: #ffdd00;
    }

    input:checked + .slider:before {
      transform: translateX(30px);
    }

    .lang-label {
      font-weight: bold;
    }

    h2 {
      font-size: 1.4em;
      margin-bottom: 10px;
      line-height: 1.4;
    }

    .underline {
      height: 4px;
      width: 60px;
      background-color: #ffdd00;
      margin: 0 auto 20px auto;
      border-radius: 2px;
    }

    label {
      display: block;
      font-size: 1em;
      margin-bottom: 10px;
      text-align: left;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 1em;
      border: 1px solid #ccc;
      border-radius: 10px;
      margin-bottom: 20px;
      box-sizing: border-box;
    }

    button {
      border: none;
      padding: 12px 20px;
      font-size: 1em;
      border-radius: 12px;
      cursor: pointer;
      width: 100%;
      font-weight: bold;
      transition: background 0.3s ease;
      margin-top: 10px;
    }

    #submitBtn {
      background-color: #ffdd00;
    }

    #submitBtn:hover {
      background-color: #fddc00cc;
    }

    #printBtn {
      background-color: #ffdd00;
    }

    #backBtn {
      background-color: #ddd;
    }

    #openBluetoothBtn {
      background-color: #0073e6;
      color: #fff;
    }

    #configBtn {
      background-color: #0073e6;
      color: #fff;
    }

    #startBarcodeBtn {
      background-color: #ffdd00;
    }


    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.4);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      box-sizing: border-box;
      z-index: 1000;
    }

    .modal {
      background: #fff;
      width: 600px;
      max-width: 95vw;
      border-radius: 16px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.25);
      overflow: hidden;
    }

    .modal-header {
      padding: 14px 18px;
      background: #ffdd00;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-weight: bold;
    }

    .modal-body {
      padding: 18px;
      text-align: left;
    }

    .close-btn {
      background: transparent;
      border: none;
      font-size: 1.2em;
      cursor: pointer;
      width: auto;
      margin-top: 0;
    }

    .link-box {
      background: #f7f7f7;
      border: 1px solid #e0e0e0;
      border-radius: 10px;
      padding: 10px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      word-break: break-all;
      margin: 12px 0 6px 0;
    }

    .link-box code {
      color: #333;
      font-weight: bold;
      font-family: monospace;
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    #openNewTabBtn {
      background-color: #ffdd00;
    }

    .info-box {
      background: #fff4b8;
      border: 1px solid #f0e1a0;
      color: #333;
      padding: 12px 14px;
      border-radius: 10px;
      box-sizing: border-box;
      text-align: left;
      line-height: 1.5;
    }

    .info-box ul {
      margin: 8px 0 0 18px;
      padding: 0;
      list-style-type: disc;
    }

    .info-box li {
      margin-bottom: 6px;
    }

    .browser-version {
      font-size: 0.9em;
      color: #555;
      margin: 12px 0 0 0;
      background: #f5f5f7;
      border: 1px solid #e5e5e8;
      padding: 8px 12px;
      border-radius: 8px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
    }

    .warn-box {
      background: #ffe6e6;
      border: 1px solid #f3c2c2;
      color: #8a1f1f;
      padding: 8px 12px;
      border-radius: 8px;
      margin-top: 8px;
    }

    #resultContainer {
      display: none;
    }

    #result img {
      max-width: 100%;
    }

    .result-logo {
      display: none;
      justify-content: center;
      margin: 4px 0 2px 0;
    }

    .logo-print {
      width: 156px;
      height: 156px;
      object-fit: contain;
    }

    @media print {
      #printBtn, #backBtn, #openBluetoothBtn, #bluetoothModal, #configImageModal, .switch-wrapper, .header, .underline, #title {
        display: none !important;
      }
      .result-logo {
        display: flex !important;
        margin: 0;
      }
      .logo-print {
        width: 156px;
        height: 156px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">
        <img id="meliLogo" src="mercado-libre-logo.png" alt="MercadoLibre Logo" class="meli-logo">
      </div>
      <div class="switch-wrapper">
        <span class="lang-label">ES</span>
        <label class="switch">
          <input type="checkbox" id="langToggle">
          <span class="slider"></span>
        </label>
        <span class="lang-label">PT</span>
      </div>
    </div>

    <h2 id="homeTitle"></h2>
    <div class="underline"></div>

    <!-- Pantalla inicial (Landing) -->
    <div id="landingContainer">
      <button type="button" id="configBtn"><img class="btn-icon" src="https://cdn-icons-png.flaticon.com/512/2040/2040504.png" alt=""> <span id="configBtnText">Configuración inicial</span></button>
      <button type="button" id="startBarcodeBtn"><img class="btn-icon" src="https://cdn-icons-png.flaticon.com/512/39/39881.png" alt=""> <span id="startBarcodeBtnText">Generar Barcode Bluetooth</span></button>
      <div id="browserVersion" class="browser-version">
        <span id="browserVersionLabel"></span>
        <div id="versionWarn" class="warn-box" style="display:none;"></div>
      </div>
    </div>

    <!-- Título para flujo de código de barras -->
    <h2 id="title" style="display:none;"></h2>

    <div id="formContainer" style="display:none;">
      <form id="barcodeForm">
        <label for="mac" id="macLabel">
          Ingresar MAC Bluetooth<br>
          <span style="font-size: 0.9em; color: #555;">(desde navegador ChromeOS: chrome://bluetooth-internals)</span>
        </label>
        <button type="button" id="openBluetoothBtn">Extraer MAC Bluetooth</button>
        <input type="text" id="mac" name="mac" placeholder="Ej: AABBCC112233" required>
        <button type="submit" id="submitBtn">Generar Código</button>
        <button type="button" id="backToHomeFromFormBtn" style="background:#ddd;">Volver</button>
      </form>
    </div>

    <div id="resultContainer">
      <div id="result"></div>
      <button id="printBtn" onclick="window.print()">Imprimir</button>
      <button id="backBtn" onclick="goBack()">Volver</button>
    </div>

    <!-- Modal para instrucciones de MAC -->
    <div id="bluetoothModal" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          <span id="bluetoothTitle">Obtener MAC Bluetooth de ChromeOS</span>
          <button class="close-btn" aria-label="Cerrar" onclick="closeBluetoothModal()">✕</button>
        </div>
        <div class="modal-body">
          <p id="bluetoothInstructions">Para obtener la dirección MAC Bluetooth, copia y abre el enlace en una nueva pestaña. En la sección Adapter, copia el valor que aparece en Address y regresa a la sección "Generar Código" para continuar el proceso.</p>
          <div class="link-box">
            <a id="bluetoothLink" href="#" rel="noopener noreferrer" style="color:#0073e6; text-decoration:none; font-weight:bold;">chrome://bluetooth-internals</a>
            <button type="button" id="copyLinkBtn" class="close-btn" style="font-size:0.95em;" onclick="copyBluetoothLink()">Copiar enlace</button>
          </div>
          <div id="copyFeedback" style="font-size:0.9em; color:#2e7d32; display:none;">Enlace copiado</div>
          <div class="modal-actions">
            <button type="button" id="openNewTabBtn" style="background:#ffdd00;" onclick="openNewTab()">Abrir una nueva pestaña</button>
            <button type="button" id="modalBackBtn" style="background:#ddd;" onclick="closeBluetoothModal()">Volver</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Pantalla de Configuración Inicial -->
    <div id="configContainer" style="display:none;">
      <div id="configIntro" class="info-box"></div>
      <div style="display:flex; flex-wrap:wrap; gap:8px; margin-top:10px;">
        <button type="button" id="barcode1Btn" style="background:#ffdd00;">BarCode 1</button>
        <button type="button" id="barcode2Btn" style="background:#ffdd00;">BarCode 2</button>
        <button type="button" id="barcode3Btn" style="background:#ffdd00;">BarCode 3</button>
        <button type="button" id="barcode4Btn" style="background:#ffdd00;">BarCode 4</button>
      </div>
      <button type="button" id="backToHomeBtn" style="background:#ddd;">Volver</button>
    </div>

    <!-- Modal para ver imagen en tamaño completo -->
    <div id="configImageModal" class="modal-overlay" style="display:none;">
      <div class="modal" style="max-width:95vw; width:auto;">
        <div class="modal-header">
          <span id="configImageTitle">Códigos de configuración</span>
          <button id="closeImageX" class="close-btn" aria-label="Cerrar" onclick="closeConfigImageModal()">✕</button>
        </div>
        <div class="modal-body" style="text-align:center;">
          <img id="configImageFull" src="ConfigBarCodeMeli.png" alt="Códigos de configuración" style="max-width:95vw; max-height:80vh; border-radius:10px;">
          <div class="modal-actions" style="justify-content:center;">
            <button type="button" id="closeImageBtn" style="background:#ddd; width:auto; min-width:140px;" onclick="closeConfigImageModal()">Cerrar</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const translations = {
      es: {
        homeTitle: "<span style='color:#0073e6; font-weight:bold;'>SHIPPING MELI</span><br>Proceso de Ring Scanner RS5100",
        title: "<span style='color:#0073e6; font-weight:bold;'>SHIPPING MELI</span><br>Generador de Código de Barras",
        macLabel: "Ingresar MAC Bluetooth<br><span style='font-size: 0.9em; color: #555;'>(Obtenido desde navegador ChromeOS: chrome://bluetooth-internals)</span>",
        macHint: "(Obtenido desde navegador ChromeOS: chrome://bluetooth-internals)",
        placeholder: "Ej: AABBCC112233",
        submitBtn: "Generar Código",
        openBluetooth: "Extraer MAC Bluetooth",
        configInit: "Configuración inicial",
        startBarcode: "Generar Barcode Bluetooth",
        bluetoothInstructions: "Para obtener la dirección MAC Bluetooth, copia y abre el enlace en una nueva pestaña. En la sección Adapter, copia el valor que aparece en Address y regresa a la sección \"Generar Código\" para continuar el proceso.",
        bluetoothTitle: "Obtener MAC Bluetooth de ChromeOS",
        copyLink: "Copiar enlace",
        openNewTab: "Abrir una nueva pestaña",
        modalBack: "Volver",
        configIntro: "Para configurar correctamente el Ring Scanner, deberá escanear los siguientes códigos de barras en el orden indicado, a fin de completar la configuración de manera adecuada.<br><br><strong>Puntos a tener en cuenta:</strong><ul><li>Si el firmware del Ring es <strong>MELI</strong>, deberá escanear los códigos del <strong>1 al 4</strong> en orden.</li><li>Si el firmware del Ring es <strong>GLOBAL</strong>, deberá escanear únicamente el <strong>código 4</strong>.</li></ul>",
        imageTitle: "Códigos de configuración",
        close: "Cerrar",
        alert: "Por favor ingresa una MAC válida (12 caracteres hexadecimales)",
        print: "Imprimir Código",
        back: "Volver",
        updateWarn: "Actualizar ChromeOS desde Configuración",
        step1: "Abre una nueva pestaña en Chrome",
        step2: "Escribe en la barra de direcciones:",
        step3: "En la sección \"Adapter\", copia el valor de \"Address\"",
        step4: "Regresa aquí y pégalo en el campo MAC",
        copied: "✓ Copiado",
        logo: "mercado-libre-logo.png"
      },
      pt: {
        homeTitle: "<span style='color:#0073e6; font-weight:bold;'>SHIPPING MELI</span><br>Processo do Ring Scanner RS5100",
        title: "<span style='color:#0073e6; font-weight:bold;'>SHIPPING MELI</span><br>Gerador de Código de Barras",
        macLabel: "Inserir MAC Bluetooth<br><span style='font-size: 0.9em; color: #555;'>(Obtido no navegador ChromeOS: chrome://bluetooth-internals)</span>",
        macHint: "(Obtido no navegador ChromeOS: chrome://bluetooth-internals)",
        placeholder: "Ex: AABBCC112233",
        submitBtn: "Gerar Código",
        openBluetooth: "Extrair MAC Bluetooth",
        configInit: "Configuração inicial",
        startBarcode: "Gerar Barcode Bluetooth",
        bluetoothInstructions: "Para obter o endereço MAC Bluetooth, copie e abra o link em uma nova aba. Na seção Adapter, copie o valor de Address e volte para a seção \"Gerar Código\" para continuar.",
        bluetoothTitle: "Obter MAC Bluetooth do ChromeOS",
        copyLink: "Copiar link",
        openNewTab: "Abrir uma nova aba",
        modalBack: "Voltar",
        configIntro: "Para configurar corretamente o Ring Scanner, você deve escanear os seguintes códigos de barras na ordem indicada, a fim de concluir a configuração adequadamente.<br><br><strong>Pontos a considerar:</strong><ul><li>Se o firmware do Ring for <strong>MELI</strong>, escaneie os códigos de <strong>1 a 4</strong> em ordem.</li><li>Se o firmware do Ring for <strong>GLOBAL</strong>, escaneie apenas o <strong>código 4</strong>.</li></ul>",
        imageTitle: "Códigos de configuração",
        close: "Fechar",
        alert: "Por favor, insira um MAC válido (12 caracteres hexadecimais)",
        print: "Imprimir Código",
        back: "Voltar",
        updateWarn: "Atualize o ChromeOS nas Configurações",
        step1: "Abra uma nova aba no Chrome",
        step2: "Digite na barra de endereços:",
        step3: "Na seção \"Adapter\", copie o valor de \"Address\"",
        step4: "Volte aqui e cole no campo MAC",
        copied: "✓ Copiado",
        logo: "Logotipo_MercadoLivre.png"
      }
    };

    let currentLang = 'es';

    function setTextIfExists(id, text) {
      const el = document.getElementById(id);
      if (el) el.innerText = text;
    }

    function setHTMLIfExists(id, html) {
      const el = document.getElementById(id);
      if (el) el.innerHTML = html;
    }

    function setPlaceholderIfExists(id, text) {
      const el = document.getElementById(id);
      if (el) el.placeholder = text;
    }

    function setSrcIfExists(id, src) {
      const el = document.getElementById(id);
      if (el) el.src = src;
    }

    function detectChromeVersion() {
      try {
        const ua = navigator.userAgent || '';
        let m = ua.match(/(?:Chrome|CriOS)\/(\d+\.\d+\.\d+\.\d+)/);
        if (m) return m[1];
        m = ua.match(/(?:Chrome|CriOS)\/(\d+\.\d+\.\d+)/);
        if (m) return m[1];
        m = ua.match(/Version\/(\d+\.\d+\.\d+\.\d+)/);
        if (m) return m[1];
        const uaData = navigator.userAgentData;
        if (uaData && Array.isArray(uaData.brands)) {
          const brand = uaData.brands.find(b => /Chrom(e|ium)/i.test(b.brand));
          if (brand && brand.version) return brand.version;
        }
        return '';
      } catch (e) { return ''; }
    }

    function getBrowserVersionLabel(lang) {
      const version = detectChromeVersion();
      if (!version) return lang === 'pt' ? 'Versão do Chrome: desconhecida' : 'Versión de Chrome: desconocida';
      let display = version;
      try {
        const m = version.match(/^(\d+)(?:\.(\d+))?(?:\.(\d+))?(?:\.(\d+))?$/);
        if (m) {
          const major = m[1];
          const s2 = m[2] || '0';
          const s3 = m[3] || '0';
          const s4 = m[4] || '0';
          if (s2 === '0' && s3 === '0' && s4 === '0') display = major;
        }
      } catch (e) {}
      return lang === 'pt' ? `Versão do Chrome: ${display}` : `Versión de Chrome: ${display}`;
    }

    function setLanguage(lang) {
      currentLang = lang;
      try { localStorage.setItem('lang', currentLang); } catch (e) {}
      
      setHTMLIfExists('homeTitle', translations[lang].homeTitle);
      setHTMLIfExists('title', translations[lang].title);
      setHTMLIfExists('macLabel', translations[lang].macLabel);
      setTextIfExists('bluetoothInstructions', translations[lang].bluetoothInstructions);
      setTextIfExists('bluetoothTitle', translations[lang].bluetoothTitle);
      setTextIfExists('copyLinkBtn', translations[lang].copyLink);
      setTextIfExists('openNewTabBtn', translations[lang].openNewTab);
      setTextIfExists('modalBackBtn', translations[lang].modalBack);
      setHTMLIfExists('configIntro', translations[lang].configIntro);
      setTextIfExists('configImageTitle', translations[lang].imageTitle);
      setTextIfExists('closeImageBtn', translations[lang].close);
      setTextIfExists('step1', translations[lang].step1);
      setTextIfExists('step2', translations[lang].step2);
      setTextIfExists('step3', translations[lang].step3);
      setTextIfExists('step4', translations[lang].step4);
      
      const bv = document.getElementById('browserVersionLabel');
      if (bv) bv.innerText = getBrowserVersionLabel(lang);
      setTextIfExists('versionWarn', translations[lang].updateWarn);
      setPlaceholderIfExists('mac', translations[lang].placeholder);
      setTextIfExists('submitBtn', translations[lang].submitBtn);
      setTextIfExists('openBluetoothBtn', translations[lang].openBluetooth);
      setTextIfExists('configBtnText', translations[lang].configInit);
      setTextIfExists('startBarcodeBtnText', translations[lang].startBarcode);
      setTextIfExists('printBtn', translations[lang].print);
      setTextIfExists('backBtn', translations[lang].back);
      setTextIfExists('backToHomeBtn', translations[lang].back);
      setTextIfExists('backToHomeFromFormBtn', translations[lang].back);
      setSrcIfExists('meliLogo', translations[lang].logo);
    }

    document.getElementById('langToggle').addEventListener('change', function () {
      setLanguage(this.checked ? 'pt' : 'es');
    });

    function detectInitialLanguage() {
      try {
        const langs = (navigator.languages || []).map(l => (l || '').toLowerCase());
        const primary = (navigator.language || '').toLowerCase();
        if (langs.some(l => l.startsWith('pt')) || primary.startsWith('pt')) return 'pt';
        return 'es';
      } catch (e) { return 'es'; }
    }

    try {
      const savedLang = localStorage.getItem('lang');
      if (savedLang === 'pt' || savedLang === 'es') {
        currentLang = savedLang;
      } else {
        currentLang = detectInitialLanguage();
      }
    } catch (e) {
      currentLang = detectInitialLanguage();
    }
    try { document.getElementById('langToggle').checked = (currentLang === 'pt'); } catch (e) {}

    setLanguage(currentLang);
    
    try {
      const version = detectChromeVersion();
      const major = parseInt((version.match(/^(\d+)/) || [,'0'])[1], 10);
      const warn = document.getElementById('versionWarn');
      if (warn) warn.style.display = (!isNaN(major) && major < 140) ? 'block' : 'none';
    } catch (e) {}

    // Navegación entre pantallas
    function showHome() {
      document.getElementById('landingContainer').style.display = 'block';
      document.getElementById('formContainer').style.display = 'none';
      document.getElementById('resultContainer').style.display = 'none';
      document.getElementById('configContainer').style.display = 'none';
      document.getElementById('homeTitle').style.display = 'block';
      document.getElementById('title').style.display = 'none';
    }

    function showConfig() {
      document.getElementById('landingContainer').style.display = 'none';
      document.getElementById('configContainer').style.display = 'block';
      document.getElementById('homeTitle').style.display = 'block';
      document.getElementById('title').style.display = 'none';
    }

    function showBarcodeForm() {
      document.getElementById('landingContainer').style.display = 'none';
      document.getElementById('configContainer').style.display = 'none';
      document.getElementById('resultContainer').style.display = 'none';
      document.getElementById('formContainer').style.display = 'block';
      document.getElementById('homeTitle').style.display = 'none';
      document.getElementById('title').style.display = 'block';
    }

    document.getElementById('configBtn').addEventListener('click', showConfig);
    document.getElementById('startBarcodeBtn').addEventListener('click', showBarcodeForm);
    document.getElementById('backToHomeBtn').addEventListener('click', showHome);
    document.getElementById('backToHomeFromFormBtn').addEventListener('click', function() {
      document.getElementById('barcodeForm').reset();
      showHome();
    });

    function showCodeImage(src) {
      const modal = document.getElementById('configImageModal');
      const img = document.getElementById('configImageFull');
      if (modal && img) {
        img.src = src;
        modal.style.display = 'flex';
      }
    }

    document.getElementById('barcode1Btn').addEventListener('click', function() { showCodeImage('code1.png'); });
    document.getElementById('barcode2Btn').addEventListener('click', function() { showCodeImage('code2.png'); });
    document.getElementById('barcode3Btn').addEventListener('click', function() { showCodeImage('code3.png'); });
    document.getElementById('barcode4Btn').addEventListener('click', function() { showCodeImage('code4.png'); });

    function closeConfigImageModal() {
      document.getElementById('configImageModal').style.display = 'none';
    }

    showHome();

    // Modal de instrucciones
    function showBluetoothModal() {
      document.getElementById('bluetoothModal').style.display = 'flex';
      document.getElementById('copyFeedback').style.display = 'none';
    }

    function closeBluetoothModal() {
      document.getElementById('bluetoothModal').style.display = 'none';
    }

    function copyBluetoothLink() {
      const textToCopy = 'chrome://bluetooth-internals';
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(textToCopy)
          .then(() => {
            const fb = document.getElementById('copyFeedback');
            fb.innerText = translations[currentLang].copied;
            fb.style.display = 'block';
            setTimeout(() => { fb.style.display = 'none'; }, 2000);
          })
          .catch(() => {});
      }
    }

    function openNewTab() {
      try {
        window.open('about:blank', '_blank');
        closeBluetoothModal();
      } catch (e) {}
    }

    document.getElementById('openBluetoothBtn').addEventListener('click', showBluetoothModal);

    document.getElementById("barcodeForm").addEventListener("submit", function(event) {
      event.preventDefault();
      const macRaw = document.getElementById("mac").value.trim();
      if (!macRaw) {
        alert(translations[currentLang].alert);
        return;
      }

      const macClean = macRaw.replace(/[^0-9A-Fa-f]/g, '').toUpperCase();
      if (!macClean || macClean.length !== 12) {
        alert(translations[currentLang].alert);
        return;
      }

      const prefix = "\\<FNC3>PH11A";
      const dataToEncode = prefix + macClean;
      const encodedData = encodeURIComponent(dataToEncode);

      // Usar API de barcode local o alternativa segura
      const barcodeURL = "https://barcode.tec-it.com/barcode.ashx?data=" + encodedData + "&code=Code128&translate-esc=on";

      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = `<img src="${barcodeURL}" alt="Código de Barras">`;

      document.getElementById("formContainer").style.display = "none";
      document.getElementById("resultContainer").style.display = "block";
    });

    function goBack() {
      document.getElementById("formContainer").style.display = "block";
      document.getElementById("resultContainer").style.display = "none";
      document.getElementById("barcodeForm").reset();
    }
  </script>
</body>
</html>

